<!DOCTYPE html>
<html>
<head>
    <title>Genius F5LE - Universal Unlocker</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; text-align: center; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 500px; margin: auto; }
        .card { background: #111; padding: 20px; border-radius: 12px; border: 1px solid #333; }
        .val { font-size: 2.5rem; color: #00ffcc; font-weight: bold; }
        button { background: #00ffcc; color: #000; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
        #log { background: #050505; color: #0f0; font-family: monospace; font-size: 11px; padding: 10px; height: 180px; overflow-y: auto; text-align: left; margin-top: 20px; border: 1px solid #222; }
    </style>
</head>
<body>

    <h1>F5LE UNIVERSAL SYNC</h1>
    <button id="go">SCAN & UNLOCK ALL DATA</button>

    <div class="grid">
        <div class="card"><div id="steps" class="val">--</div><div>Steps</div></div>
        <div class="card"><div id="hr" class="val">--</div><div>Heart Rate</div></div>
    </div>

    <div id="log">Log: Ready...</div>

    <script>
        const logger = (m) => { 
            const d = document.getElementById('log');
            d.innerHTML += `<div>> ${m}</div>`; 
            d.scrollTop = d.scrollHeight;
        };

        document.getElementById('go').onclick = async () => {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'F5' }, { namePrefix: 'Genius' }],
                    optionalServices: ['0000fee7-0000-1000-8000-00805f9b34fb', 'battery_service', 0xFFE0, 'heart_rate']
                });

                const server = await device.gatt.connect();
                logger("CONNECTED. Finding all data paths...");

                const services = await server.getPrimaryServices();
                
                for (const service of services) {
                    logger("Checking Service: " + service.uuid);
                    const chars = await service.getCharacteristics();
                    
                    for (const char of chars) {
                        // If the characteristic allows notifications, open it!
                        if (char.properties.notify || char.properties.indicate) {
                            try {
                                await char.startNotifications();
                                char.addEventListener('characteristicvaluechanged', (e) => {
                                    const val = e.target.value;
                                    let hex = "";
                                    for (let i = 0; i < val.byteLength; i++) {
                                        hex += val.getUint8(i).toString(16).padStart(2, '0').toUpperCase() + " ";
                                    }
                                    logger(`DATA [${char.uuid.substring(4,8)}]: ${hex}`);
                                    
                                    // Basic parser for incoming numbers
                                    if (val.byteLength > 1) {
                                        const lastByte = val.getUint8(val.byteLength - 1);
                                        if (lastByte > 40 && lastByte < 200) document.getElementById('hr').innerText = lastByte;
                                    }
                                });
                                logger("  - Listening to " + char.uuid.substring(4,8));
                            } catch(e) {}
                        }

                        // Try to send a "Wake Up" to every writable characteristic
                        if (char.properties.write || char.properties.writeWithoutResponse) {
                            try {
                                await char.writeValue(new Uint8Array([0x01]));
                                await char.writeValue(new Uint8Array([0xAB, 0x01]));
                                logger("  - Sent Wake-up to " + char.uuid.substring(4,8));
                            } catch(e) {}
                        }
                    }
                }
                logger("SCAN COMPLETE. Start a test on the watch face now.");

            } catch (err) {
                logger("ERROR: " + err.message);
            }
        };
    </script>
</body>
</html>
