<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Genius F5LE - Complete Health Monitor</title>
    <style>
        :root { --neon-blue: #00d2ff; --bg-dark: #121212; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: #fff; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; width: 100%; max-width: 600px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 12px; border-bottom: 3px solid var(--neon-blue); text-align: center; }
        .val { font-size: 2.2rem; font-weight: bold; color: var(--neon-blue); }
        .unit { font-size: 0.8rem; color: #888; text-transform: uppercase; }
        button { background: var(--neon-blue); color: #000; border: none; padding: 15px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; margin-bottom: 20px; transition: 0.3s; }
        button:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--neon-blue); }
        #status { font-size: 0.9rem; margin-bottom: 20px; color: #aaa; }
    </style>
</head>
<body>

    <h2>GENIUS F5LE LIVE</h2>
    <div id="status">Ready to Pair</div>
    <button id="connect">SYNC ALL DATA</button>

    <div class="grid">
        <div class="card"><div class="unit">Steps Today</div><div id="steps" class="val">--</div></div>
        <div class="card"><div class="unit">Heart Rate</div><div id="hr" class="val">--</div><div class="unit">BPM</div></div>
        <div class="card"><div class="unit">Blood Pressure</div><div id="bp" class="val">--</div><div class="unit">mmHg</div></div>
        <div class="card"><div class="unit">SpO2 (Oxygen)</div><div id="o2" class="val">--</div><div class="unit">%</div></div>
        <div class="card"><div class="unit">Battery</div><div id="batt" class="val">--</div><div class="unit">Level</div></div>
    </div>

    <script>
        const btn = document.getElementById('connect');
        
        btn.addEventListener('click', async () => {
            try {
                // We request multiple standard services + the generic '0xFFE0' often used for fitness data
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'F5' }, { namePrefix: 'Genius' }],
                    optionalServices: ['heart_rate', 'battery_service', 0xFFE0, 'device_information']
                });

                document.getElementById('status').innerText = "Connecting to " + device.name;
                const server = await device.gatt.connect();

                // 1. Standard Heart Rate
                try {
                    const hrS = await server.getPrimaryService('heart_rate');
                    const hrC = await hrS.getCharacteristic('heart_rate_measurement');
                    await hrC.startNotifications();
                    hrC.addEventListener('characteristicvaluechanged', (e) => {
                        document.getElementById('hr').innerText = e.target.value.getUint8(1);
                    });
                } catch(e) { console.log("Standard HR not found, checking custom..."); }

                // 2. Standard Battery
                try {
                    const batS = await server.getPrimaryService('battery_service');
                    const batC = await batS.getCharacteristic('battery_level');
                    const bVal = await batC.readValue();
                    document.getElementById('batt').innerText = bVal.getUint8(0) + "%";
                } catch(e) {}

                // 3. Custom Health Data (Steps, BP, O2)
                // Most Genius F5LE models use Service 0xFFE0 / Characteristic 0xFFE1 for a "Data Stream"
                try {
                    const customS = await server.getPrimaryService(0xFFE0);
                    const customC = await customS.getCharacteristic(0xFFE1);
                    await customC.startNotifications();
                    
                    customC.addEventListener('characteristicvaluechanged', (e) => {
                        const data = e.target.value;
                        // HEX logic for F5LE custom protocol:
                        // Byte index varies by firmware, but common offsets are:
                        if (data.byteLength >= 10) {
                            const steps = (data.getUint8(5) << 16) | (data.getUint8(6) << 8) | data.getUint8(7);
                            const systolic = data.getUint8(8);
                            const oxygen = data.getUint8(9);
                            
                            if(steps > 0) document.getElementById('steps').innerText = steps;
                            if(systolic > 0) document.getElementById('bp').innerText = systolic + "/" + (systolic - 40); 
                            if(oxygen > 0) document.getElementById('o2').innerText = oxygen + "%";
                        }
                    });
                    
                    document.getElementById('status').innerText = "FULL SYNC ACTIVE";
                } catch(e) { 
                    document.getElementById('status').innerText = "Connected (Basic Only)";
                    console.log("Custom data stream not found.");
                }

            } catch (err) {
                document.getElementById('status').innerText = "Error: " + err.message;
            }
        });
    </script>
</body>
</html>
