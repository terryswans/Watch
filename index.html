<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genius F5LE Pro Fitness</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 500px; margin-top: 20px; }
        .stat-card { background: #1e293b; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #334155; }
        .stat-value { font-size: 2rem; font-weight: bold; color: #38bdf8; margin: 10px 0; }
        .stat-label { font-size: 0.8rem; color: #94a3b8; text-transform: uppercase; }
        .btn-connect { background: #38bdf8; color: #0f172a; border: none; padding: 15px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; font-size: 1.1rem; box-shadow: 0 4px 14px 0 rgba(56, 189, 248, 0.39); }
        .status-dot { height: 10px; width: 10px; background-color: #ef4444; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .connected .status-dot { background-color: #22c55e; }
        #log { font-size: 0.7rem; color: #64748b; margin-top: 20px; max-width: 400px; }
    </style>
</head>
<body>

    <h1>Fitness Dashboard</h1>
    <div id="connectionStatus"><span class="status-dot"></span> Disconnected</div>
    <br>
    <button class="btn-connect" id="connectBtn">Connect Genius F5LE</button>

    <div class="dashboard">
        <div class="stat-card">
            <div class="stat-label">Heart Rate</div>
            <div id="hr-val" class="stat-value">--</div>
            <div class="stat-label">BPM</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Steps</div>
            <div id="step-val" class="stat-value">--</div>
            <div class="stat-label">Today</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Battery</div>
            <div id="batt-val" class="stat-value">--</div>
            <div class="stat-label">Percent</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Device Status</div>
            <div id="dev-status" class="stat-value">OFF</div>
            <div class="stat-label">Live Link</div>
        </div>
    </div>

    <div id="log">Logs: App initialized.</div>

    <script>
        const connectBtn = document.getElementById('connectBtn');
        const log = (msg) => { document.getElementById('log').innerText = "Log: " + msg; };

        connectBtn.addEventListener('click', async () => {
            try {
                log("Requesting device...");
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'F5' }, { namePrefix: 'Genius' }],
                    optionalServices: ['heart_rate', 'battery_service', 'user_data', 'device_information']
                });

                log("Connecting to GATT...");
                const server = await device.gatt.connect();
                document.getElementById('connectionStatus').classList.add('connected');
                document.getElementById('dev-status').innerText = "LIVE";

                // 1. HEART RATE
                try {
                    const hrService = await server.getPrimaryService('heart_rate');
                    const hrChar = await hrService.getCharacteristic('heart_rate_measurement');
                    await hrChar.startNotifications();
                    hrChar.addEventListener('characteristicvaluechanged', (event) => {
                        const value = event.target.value;
                        const hr = value.getUint8(1); // Standard HR format
                        document.getElementById('hr-val').innerText = hr;
                    });
                    log("Heart rate monitoring active.");
                } catch(e) { log("HR service not available."); }

                // 2. BATTERY
                try {
                    const battService = await server.getPrimaryService('battery_service');
                    const battChar = await battService.getCharacteristic('battery_level');
                    const battVal = await battChar.readValue();
                    document.getElementById('batt-val').innerText = battVal.getUint8(0) + "%";
                } catch(e) { }

                // 3. STEPS (Standard User Data Service)
                try {
                    const userData = await server.getPrimaryService('user_data');
                    const stepChar = await userData.getCharacteristic('step_count'); 
                    // Note: Some watches use custom UUIDs for steps if this fails.
                    const steps = await stepChar.readValue();
                    document.getElementById('step-val').innerText = steps.getUint32(0, true);
                } catch(e) { 
                    document.getElementById('step-val').innerText = "N/A";
                    log("Step service is restricted or custom."); 
                }

                device.addEventListener('gattserverdisconnected', () => {
                    document.getElementById('connectionStatus').classList.remove('connected');
                    document.getElementById('dev-status').innerText = "OFF";
                    log("Disconnected.");
                });

            } catch (error) {
                log("Error: " + error.message);
                console.error(error);
            }
        });
    </script>
</body>
</html>
