<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Genius F5LE - Full Health Access</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; text-align: center; padding: 20px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 400px; margin: 20px auto; }
        .box { background: #333; padding: 15px; border-radius: 10px; border: 1px solid #444; }
        .val { font-size: 1.8rem; color: #00ffcc; font-weight: bold; }
        .label { font-size: 0.7rem; color: #aaa; text-transform: uppercase; }
        button { background: #00ffcc; color: black; border: none; padding: 15px 30px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        #log { font-size: 0.7rem; color: #666; margin-top: 20px; background: #000; padding: 10px; text-align: left; overflow-y: scroll; height: 100px; }
    </style>
</head>
<body>

    <h2>GENIUS F5LE DEEP SYNC</h2>
    <button id="scanBtn">SEARCH FOR ALL SERVICES</button>
    <div id="status" style="margin: 15px; color: #00ffcc;">Status: Not Connected</div>

    <div class="stat-grid">
        <div class="box"><div class="label">Step Count</div><div id="steps" class="val">--</div></div>
        <div class="box"><div class="label">Heart Rate</div><div id="hr" class="val">--</div></div>
        <div class="box"><div class="label">Blood Pressure</div><div id="bp" class="val">--</div></div>
        <div class="box"><div class="label">SpO2 Oxygen</div><div id="o2" class="val">--</div></div>
    </div>

    <div id="log">Logs initialized...</div>

    <script>
        const log = (m) => { document.getElementById('log').innerHTML += `<div>${m}</div>`; };
        
        document.getElementById('scanBtn').onclick = async () => {
            try {
                // We add the most common "Health" UUIDs used by Genius/FitPro/DaFit watches
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'F5' }, { namePrefix: 'Genius' }],
                    optionalServices: [
                        'heart_rate', 
                        'battery_service',
                        0xFFE0, // Common fitness data
                        0xFEE7, // Common "Steps" for Chinese watches
                        0x180D, // Heart Rate
                        '0000fee7-0000-1000-8000-00805f9b34fb', // Step Service UUID
                        '6e400001-b5a3-f393-e0a9-e50e24dcca9e'  // Nordic UART (All data stream)
                    ]
                });

                const server = await device.gatt.connect();
                document.getElementById('status').innerText = "Status: DEEP CONNECTED";
                log("Scanning all services...");

                const services = await server.getPrimaryServices();
                
                for (const service of services) {
                    log("Found Service: " + service.uuid);
                    const characteristics = await service.getCharacteristics();
                    
                    for (const char of characteristics) {
                        log(" -> Found Characteristic: " + char.uuid);
                        
                        // Check if it's a Notify characteristic (This is where "All Data" usually lives)
                        if (char.properties.notify || char.properties.indicate) {
                            await char.startNotifications();
                            char.addEventListener('characteristicvaluechanged', handleData);
                            log(" !! Listening to: " + char.uuid);
                        }
                    }
                }
            } catch (e) {
                log("Error: " + e.message);
            }
        };

        function handleData(event) {
            const data = event.target.value;
            log("Data received! Bytes: " + data.byteLength);

            // This is the "Magic" parser for F5LE style watches
            // Data is usually sent as a 10-20 byte packet
            if (data.byteLength >= 7) {
                // Standard Heart Rate (if from HR service)
                if (data.byteLength == 2) {
                    document.getElementById('hr').innerText = data.getUint8(1);
                }
                
                // Generic Fitness Packet Parser
                // Most F5LE watches send steps in byte 5, 6, 7
                const steps = (data.getUint8(4) << 16) | (data.getUint8(5) << 8) | data.getUint8(6);
                if (steps > 0 && steps < 100000) document.getElementById('steps').innerText = steps;

                // Health data (BP/O2) often comes in bytes 8 and 9
                if (data.byteLength >= 10) {
                    const sys = data.getUint8(8);
                    const o2 = data.getUint8(9);
                    if (sys > 40) document.getElementById('bp').innerText = sys + "/80";
                    if (o2 > 50) document.getElementById('o2').innerText = o2 + "%";
                }
            }
        }
    </script>
</body>
</html>
